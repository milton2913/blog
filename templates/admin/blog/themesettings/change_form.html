{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
{{ block.super }}
<style>
    /* Simple Tab Styles */
    .tab-container {
        margin-bottom: 20px;
        border-bottom: 1px solid #ccc;
    }

    .tab-button {
        display: inline-block;
        padding: 10px 20px;
        cursor: pointer;
        background: #f8f8f8;
        border: 1px solid #ccc;
        border-bottom: none;
        margin-right: 5px;
        border-radius: 5px 5px 0 0;
        font-weight: bold;
        color: #666;
    }

    .tab-button.active {
        background: #fff;
        color: #333;
        border-bottom: 1px solid #fff;
        /* Hide bottom border */
        position: relative;
        top: 1px;
    }

    .tab-content {
        display: none;
        padding-top: 20px;
    }

    .tab-content.active {
        display: block;
    }

    /* Hide original fieldsets initially to prevent FOUC, but shown by JS */
    .module {
        margin-bottom: 0 !important;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fieldsets = document.querySelectorAll('fieldset.module');
        const tabContainer = document.createElement('div');
        tabContainer.className = 'tab-container';

        // Insert tabs before the first fieldset
        if (fieldsets.length > 0) {
            fieldsets[0].parentNode.insertBefore(tabContainer, fieldsets[0]);
        }

        fieldsets.forEach((fieldset, index) => {
            // Get title from h2, fallback to 'General'
            const h2 = fieldset.querySelector('h2');
            let title = h2 ? h2.innerText : 'Section ' + (index + 1);

            // Hide the h2 as it's now a tab
            if (h2) h2.style.display = 'none';

            // Create Tab Button
            const btn = document.createElement('div');
            btn.className = 'tab-button' + (index === 0 ? ' active' : '');
            btn.innerText = title;
            btn.onclick = function () {
                // Remove active class from all
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('fieldset.module').forEach(f => f.style.display = 'none');

                // Activate this
                btn.classList.add('active');
                fieldset.style.display = 'block';
            };
            tabContainer.appendChild(btn);

            // Initial state
            if (index !== 0) {
                fieldset.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}